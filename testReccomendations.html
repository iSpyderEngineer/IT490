<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Movie Recommendations</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Movie Recommendations</h1>

    <div id="movies-by-genre-container">
        <!-- Display movies by genre recommendations here -->
    </div>

    <div id="recent-watched-container">
        <!-- Display recent watched recommendations here -->
    </div>

    <div id="actor-director-container">
        <!-- Display actor/director recommendations here -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Retrieve username from sessionStorage
            const username = sessionStorage.getItem('username');
            console.log('Username in sessionStorage:', username);

            // Check if the username is available
            if (username) {
                // Make AJAX requests to get movie recommendations
                getMoviesByMovieAndGenre(username);
                getRecentWatchedRecommendations(username);
                getRecommendationActorDirector(username);
            } else {
                console.log("Username not found in sessionStorage");
            }
        });

        function getMoviesByMovieAndGenre(username) {
            $.ajax({
                url: 'RabbitMQ/apiConsumer.php',
                method: 'POST',
                data: {
                    type: 'getMoviesByMovieAndGenre',
                    username: username
                },
                dataType: 'json',
                success: function (response) {
                    displayRecommendations('movies-by-genre-container', 'Movies by Genre Recommendations', response.recommendations);
                },
                error: function (error) {
                    console.error('Error fetching movies by genre recommendations:', error);
                }
            });
        }

        function getRecentWatchedRecommendations(username) {
            $.ajax({
                url: 'RabbitMQ/apiConsumer.php',
                method: 'POST',
                data: {
                    type: 'getRecentWatchedRecommendations',
                    username: username
                },
                dataType: 'json',
                success: function (response) {
                    displayRecommendations('recent-watched-container', 'Recent Watched Recommendations', response.recommendations);
                },
                error: function (error) {
                    console.error('Error fetching recent watched recommendations:', error);
                }
            });
        }

        function getRecommendationActorDirector(username) {
            $.ajax({
                url: 'RabbitMQ/apiConsumer.php',
                method: 'POST',
                data: {
                    type: 'recommendationActorDirector',
                    username: username
                },
                dataType: 'json',
                success: function (response) {
                    displayRecommendations('actor-director-container', 'Actor/Director Recommendations', response.recommendations);
                },
                error: function (error) {
                    console.error('Error fetching actor/director recommendations:', error);
                }
            });
        }

        function displayRecommendations(containerId, title, recommendations) {
            const container = document.getElementById(containerId);

            if (recommendations && recommendations.length > 0) {
                // Display section title
                const sectionTitle = document.createElement('h2');
                sectionTitle.textContent = title;
                container.appendChild(sectionTitle);

                // Display recommendations
                recommendations.forEach(movie => {
                    const movieBlock = document.createElement('div');
                    movieBlock.classList.add('movie-block');
                    movieBlock.innerHTML = `
                        <h3>${movie.Title}</h3>
                        <p>Director: ${movie.Director}</p>
                        <p>Genre: ${movie.Genre}</p>
                        <p>Year: ${movie.Year}</p>
                        <img src="${movie.PosterURL}" alt="${movie.Title} Poster">
                    `;
                    container.appendChild(movieBlock);
                });
            } else {
                // Handle case where no recommendations are found
                console.log(`No recommendations found for ${title}`);
                const noRecommendationsMessage = document.createElement('p');
                noRecommendationsMessage.textContent = `No recommendations available for ${title}.`;
                container.appendChild(noRecommendationsMessage);
            }
        }
    </script>
</body>
</html>
