<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Register</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="navigation"></div>
    
    <div id="error"></div>
    
    <div>
        <form id="register">
            <h4>Register</h4>
            <table>
                <tr>
                    <th>First Name:</th>
                    <td><input type="text" id="firstname" name="firstname" size="25" required></td>
                </tr>
                <!-- Other form fields -->
            </table>
            <button type="submit" name="submit" id="submit">Submit</button>
        </form>
    </div>
    
    <script>
        let form = $("#register");
        let error = $("#error");

        form.on("submit", async function (event) {
            event.preventDefault();

            let formData = {
                type: "register",
                firstname: $("#firstname").val(),
                // Include other form field values
            };

            try {
                let response = await $.ajax({
                    url: 'RabbitMQ/dbConsumer.php', // Use dbConsumer.php for registration
                    method: "POST",
                    data: formData,
                    dataType: 'json'
                });

                console.log(response);

                // Check the returnCode even if it's in quotes
                showMessage(response.message, response.returnCode === "1" || response.returnCode === 1 || response["returnCode"] === "1" || response["returnCode"] === 1 ? "success" : "error");

                if (response.returnCode === "1" || response.returnCode === 1 || response["returnCode"] === "1" || response["returnCode"] === 1) {
                    window.location.href = "newProfile.html";
                }
            } catch (error) {
                showMessage(error.message, "error");
            }
        });

        function showMessage(message, result) {
            error.html("<div class='alert alert-" + result + "'>" + message + "</div>");
        }
    </script>
</body>
</html>

