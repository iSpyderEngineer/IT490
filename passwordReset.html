<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Password Reset</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Password Reset</h1>

    <form id="password-reset-form">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required><br><br>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br><br>

        <label for="new-password">New Password:</label>
        <input type="password" id="new-password" name="password" required><br><br>

        <button type="submit">Reset Password</button>
    </form>

    <script>
        $(document).ready(function () {
            $('#password-reset-form').submit(function (event) {
                event.preventDefault(); // Prevent default form submission

                // Sanitize and validate input data
                const username = sanitizeInput($('#username').val());
                const email = sanitizeInput($('#email').val());
                const password = sanitizeInput($('#new-password').val());

                if (username && email && password) {
                    // AJAX request to reset password
                    $.ajax({
                        url: 'RabbitMQ/dbConsumer.php',
                        method: 'POST',
                        data: {
                            type: 'resetPassword',
                            username: username,
                            email: email,
                            password: password
                        },
                        dataType: 'json',
                        success: function (response) {
                            // Handle success response
                            console.log('Password reset successful:', response);
                            // Add your logic for success message or redirect
                        },
                        error: function (error) {
                            // Handle error response
                            console.error('Error resetting password:', error);
                            // Add your logic for error message
                        }
                    });
                } else {
                    // Handle invalid input
                    console.error('Invalid input.');
                    // Add your logic for invalid input message
                }
            });

            // Function to sanitize input by removing certain characters
            function sanitizeInput(input) {
                // Replace characters that could be used in SQL injection
                const sanitizedInput = input.replace(/[\[\]{}()*+?.,\\^$|#\s]/g, '');
                return sanitizedInput;
            }
        });
    </script>
</body>
</html>
