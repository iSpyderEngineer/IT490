<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Update User Preferences</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Update User Preferences</h1>

    <form id="updatePreferencesForm">
        <label for="favActor">Favorite Actor:</label>
        <input type="text" id="favActor" name="favActor">

        <label for="favGenre">Favorite Genre:</label>
        <input type="text" id="favGenre" name="favGenre">

        <label for="favDirector">Favorite Director:</label>
        <input type="text" id="favDirector" name="favDirector">

        <label for="favMovie">Favorite Movie:</label>
        <input type="text" id="favMovie" name="favMovie">

        <label for="biography">Biography:</label>
        <textarea id="biography" name="biography"></textarea>

        <button type="button" id="submitPreferencesBtn">Update Preferences</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Retrieve username from sessionStorage
            const username = sessionStorage.getItem('username');
            console.log('Username in sessionStorage:', username);

            // Check if the username is available
            if (username) {
                // Event listener for the button
                $('#submitPreferencesBtn').click(function () {
                    // Get values from the form
                    const favActor = $('#favActor').val();
                    const favGenre = $('#favGenre').val();
                    const favDirector = $('#favDirector').val();
                    const favMovie = $('#favMovie').val();
                    const biography = $('#biography').val();

                    // Make an AJAX request to update user preferences
                    $.ajax({
                        url: 'RabbitMQ/dbConsumer.php',
                        method: 'POST',
                        data: {
                            type: 'updatePreferences',
                            username: username,
                            favActor: favActor,
                            favGenre: favGenre,
                            favDirector: favDirector,
                            favMovie: favMovie,
                            biography: biography
                        },
                        dataType: 'json',
                        success: function (result) {
                            console.log('Preferences updated successfully:', result);
                            // You can handle success actions here
                        },
                        error: function (error) {
                            console.error('Error updating preferences:', error);
                        }
                    });
                });
            } else {
                console.log("Username not found in sessionStorage");
            }
        });
    </script>
</body>
</html>
