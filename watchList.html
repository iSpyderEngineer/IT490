    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Watchlist Management</title>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <style>
            .movie-container {
                display: flex;
                overflow-x: auto;
                white-space: nowrap;
                margin-bottom: 10px;
            }

            .movie-block {
                border: 1px solid #ccc;
                margin-right: 10px;
                padding: 10px;
                width: 200px; /* Adjusts the width as needed */
                display: flex;
                flex-direction: column;
            }

            .movie-block img {
                max-width: 100%;
                height: auto;
            }

            .delete-button {
                margin-top: 10px;
                cursor: pointer;
                background-color: #ff0000;
                color: #ffffff;
                border: none;
                padding: 5px 10px;
                border-radius: 5px;
            }

            .move-to-watched-button {
                margin-top: 10px;
                cursor: pointer;
                background-color: #4285f4;
                color: #ffffff;
                border: none;
                padding: 5px 10px;
                border-radius: 5px;
            }

            .movie-block img {
                max-width: 100%;
                height: 200px; /* Set a fixed height for all images */
                object-fit: cover; /* Maintain aspect ratio and cover the entire space */
            }

        </style>
    </head>
    <body>
        <h1>Watchlist Management</h1>

        <div id="navbar-container"></div>

        <div id="watchlist-container">
            
        </div>
        

        <script>

            function loadNavbar() {
                        const navbarContainer = document.getElementById('navbar-container');
                        const xhr = new XMLHttpRequest();
                        xhr.onreadystatechange = function() {
                            if (xhr.readyState === 4) {
                                if (xhr.status === 200) {
                                    navbarContainer.innerHTML = xhr.responseText;
                                } else {
                                    console.error('Error loading navbar:', xhr.status);
                                }
                            }
                        };
                        xhr.open('GET', 'components/navbar.html', true);
                        xhr.send();
                    }


            document.addEventListener('DOMContentLoaded', function () {
                // Retrieve username from sessionStorage
                const username = sessionStorage.getItem('username');
                console.log('Username in sessionStorage:', username);

                loadNavbar();

                // Checks if the username is available (makes sure it is set from storage session)
                if (username) {
                    // Makes an AJAX request to get watchlist
                    getWatchlist(username);
                } else {
                    console.log("Username not found in sessionStorage");
                }
            });

            function getWatchlist(username) {
                $.ajax({
                    url: 'RabbitMQ/dbConsumer.php',
                    method: 'GET',
                    data: {
                        type: 'getWatchList',
                        username: username
                    },
                    dataType: 'json',
                    success: function (response) {
                        displayWatchlist(response);
                    },
                    error: function (error) {
                        console.error('Error fetching watchlist:', error);
                    }
                });
            }

            function addToWatchlist() {
                const movieTitle = $('#movie-title').val();

                if (movieTitle) {
                    $.ajax({
                        url: 'RabbitMQ/dbConsumer.php',
                        method: 'POST',
                        data: {
                            type: 'addToWatchList',
                            username: sessionStorage.getItem('username'), // Retrieves username from sessionStorage
                            movieTitle: movieTitle
                        },
                        dataType: 'json',
                        success: function (response) {
                            console.log('Movie added to watchlist:', response);
                            // Refresh watchlist after adding a movie
                            getWatchlist(sessionStorage.getItem('username'));
                        },
                        error: function (error) {
                            console.error('Error adding movie to watchlist:', error);
                        }
                    });
                } else {
                    console.error('Movie title cannot be empty.');
                }
            }

            function deleteFromWatchlist(listID) {
                console.log("requesting delete from watchlist");
                const ListID = listID;

                if (ListID) {
                    $.ajax({
                        url: 'RabbitMQ/dbConsumer.php',
                        method: 'POST',
                        data: {
                            type: 'deleteFromWatchList',
                            watchListID: ListID
                        },
                        dataType: 'json',
                        success: function (response) {
                            console.log('Movie deleted from watchlist:', response);
                            // Refreshes the watchlist after deleting a movie so the user doesn't have to manually reload
                            getWatchlist(sessionStorage.getItem('username'));
                        },
                        error: function (error) {
                            console.error('Error deleting movie from watchlist:', error);
                        }
                    });
                } else {
                    console.error('Movie ID cannot be empty.');
                }
            }

            function moveToWatchedList(movieId, movieTitle, posterURL, year, mediaType) {
                $.ajax({
                    url: 'RabbitMQ/dbConsumer.php',
                    method: 'POST',
                    data: {
                        type: 'addToWatchedListAndRemoveFromWatchList',
                        username: sessionStorage.getItem('username'),
                        MovieID: movieId,
                        movieTitle: movieTitle,
                        posterURL: posterURL,
                        year: year,
                        mediaType: mediaType
                    },
                    dataType: 'json',
                    success: function (response) {
                        console.log('Movie moved to watched list:', response);
                        // Refresh watchlist after moving a movie
                        getWatchlist(sessionStorage.getItem('username'));
                    },
                    error: function (error) {
                        console.error('Error moving movie to watched list:', error);
                    }
                });
            }

            function displayWatchlist(response) {
                const watchlistContainer = document.getElementById('watchlist-container');
                watchlistContainer.innerHTML = '';

                if (response && response.length > 0) {
                    // Display watchlist
                    const sectionTitle = document.createElement('h2');
                    sectionTitle.textContent = 'Watchlist';
                    watchlistContainer.appendChild(sectionTitle);

                    // Create a container for the movie blocks with scrolling
                    const movieContainer = document.createElement('div');
                    movieContainer.classList.add('movie-container');
                    watchlistContainer.appendChild(movieContainer);

                    response.forEach(movie => {
                        const movieBlock = document.createElement('div');
                        movieBlock.classList.add('movie-block');
                        movieBlock.innerHTML = `
                            <a href="movie.html?Type=${movie.MediaType}&movieID=${movie.MovieID}">
                                <img src="${movie.PosterURL}" alt="${movie.MovieTitle} Poster">
                                <h3>${movie.MovieTitle}</h3>
                            </a>
                            <p hidden id="list-id">${movie.ListID}</p>
                            <p>Year: ${movie.Year}</p>
                            <button class="delete-button" onclick="deleteFromWatchlist(${movie.ListID})">Delete</button>
                            <button class="move-to-watched-button" onclick="moveToWatchedList(${movie.MovieID}, '${movie.MovieTitle}', '${movie.PosterURL}', '${movie.Year}', '${movie.MediaType}')">Move to Watched List</button>
                        `;
                        movieContainer.appendChild(movieBlock);
                    });

                    // Add a button for scrolling to see more recommendations
                    const scrollButton = document.createElement('button');
                    scrollButton.textContent = 'See More';
                    scrollButton.addEventListener('click', function () {
                        movieContainer.scrollLeft += 200; // Adjust the scrolling distance as needed
                    });
                    watchlistContainer.appendChild(scrollButton);
                } else {
                    // Handle case where watchlist is empty
                    console.log('Watchlist is empty');
                    const emptySetResponse = [{"returnCode":"2","message":"Empty Set"}];
                    if (JSON.stringify(response) === JSON.stringify(emptySetResponse)) {
                        const noWatchlistMessage = document.createElement('p');
                        noWatchlistMessage.textContent = 'Watchlist is empty.';
                        watchlistContainer.appendChild(noWatchlistMessage);
                    } else {
                        // In case of unexpected empty response
                        const errorMessage = document.createElement('p');
                        errorMessage.textContent = 'An error occurred while fetching the watchlist.';
                        watchlistContainer.appendChild(errorMessage);
                    }
                }
            }
        </script>
    </body>
    </html>
