<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Recommendations</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        .movie-container {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            margin-bottom: 10px;
        }

        .movie-block {
            border: 1px solid #ccc;
            margin-right: 10px;
            padding: 10px;
            width: 200px; /* Adjust the width as needed */
            cursor: pointer;
        }

        .movie-image {
            max-width: 100%;
            height: auto;
        }
    </style>
    
</head>
<body>
    
    

    <h1>Movie Recommendations</h1>

    <div id="navbar-container"></div>

    <div id="movies-by-genre-container">
        <!-- Display movies by genre recommendations here -->
    </div>


    <div id="recent-watched-container">
        <!-- Display recent watched recommendations here -->
    </div>

    <div id="actor-director-container">
        <!-- Display actor/director recommendations here -->
    </div>

    <script>

        function loadNavbar(callback) {
            const navbarContainer = document.getElementById('navbar-container');
            const xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        navbarContainer.innerHTML = xhr.responseText;
                        // Call the callback function after loading the navbar content
                        callback();
                    } else {
                        console.error('Error loading navbar:', xhr.status);
                    }
                }
            };
            xhr.open('GET', 'components/navbar.html', true);
            xhr.send();
        }



        document.addEventListener('DOMContentLoaded', function () {
            const username = sessionStorage.getItem('username');
            console.log('Username in sessionStorage:', username);

            loadNavbar();

            if (username) {
                getMoviesByMovieAndGenre(username);
                getRecentWatchedRecommendations(username);
                getRecommendationActorDirector(username);
            } else {
                console.log("Username not found in sessionStorage");
            }
        });

        function getMoviesByMovieAndGenre(username) {
            $.ajax({
                url: 'RabbitMQ/apiConsumer.php',
                method: 'GET',
                data: {
                    type: 'getMoviesByMovieAndGenre',
                    username: username
                },
                dataType: 'json',
                success: function (response) {
                    displayRecommendations('movies-by-genre-container', 'Movies by Genre Recommendations', response);
                },
                error: handle500Error('movies-by-genre-container', 'Movies by Genre Recommendations')
            });
        }

        function getRecentWatchedRecommendations(username) {
            $.ajax({
                url: 'RabbitMQ/apiConsumer.php',
                method: 'GET',
                data: {
                    type: 'getRecentWatchedRecommendations',
                    username: username
                },
                dataType: 'json',
                success: function (response) {
                    displayRecommendations('recent-watched-container', 'Recent Watched Recommendations', response);
                },
                error: handle500Error('recent-watched-container', 'Recent Watched Recommendations')
            });
        }

        function getRecommendationActorDirector(username) {
            $.ajax({
                url: 'RabbitMQ/apiConsumer.php',
                method: 'GET',
                data: {
                    type: 'recommendationActorDirector',
                    username: username
                },
                dataType: 'json',
                success: function (response) {
                    displayRecommendations('actor-director-container', 'Actor/Director Recommendations', response);
                },
                error: handle500Error('actor-director-container', 'Actor/Director Recommendations')
            });
        }

        function displayRecommendations(containerId, title, recommendations) {
            const container = document.getElementById(containerId);

            if (recommendations && recommendations.length > 0) {
                const sectionTitle = document.createElement('h2');
                sectionTitle.textContent = title;
                container.appendChild(sectionTitle);

                const movieContainer = document.createElement('div');
                movieContainer.classList.add('movie-container');
                container.appendChild(movieContainer);

                recommendations.slice(0, 10).forEach(movie => {
                    const movieBlock = document.createElement('div');
                    movieBlock.classList.add('movie-block');

                    let mediaId = movie.MediaID || movie.MovieID;
                    let poster = movie.PosterURL || movie.poster_path;
                    let title = movie.Title || movie.title;
                    movieBlock.innerHTML = `
                        <a href="movie.html?movieID=${mediaId}&Type=${movie.MediaType}">
                            <img class="movie-image" src="${poster}">
                            <h3>${title}</h3>
                        </a>
                    `;

                    movieContainer.appendChild(movieBlock);
                });

                const scrollButton = document.createElement('button');
                scrollButton.textContent = 'See More';
                scrollButton.addEventListener('click', function () {
                    movieContainer.scrollLeft += 200;
                });
                container.appendChild(scrollButton);
            } else {
                console.log(`No recommendations found for ${title}`);
                const noRecommendationsMessage = document.createElement('p');
                noRecommendationsMessage.textContent = `No recommendations available for ${title}.`;
                container.appendChild(noRecommendationsMessage);
            }
        }

        function handle500Error(containerId, title) {
            return function(error) {
                console.error(`Error fetching ${title} recommendations:`, error);
                if (error.status === 500) {
                    const container = document.getElementById(containerId);
                    container.innerHTML = `<p>There was a connectivity issue while fetching ${title} recommendations.</p>`;
                }
            };
        }
    </script>
</body>
</html>




